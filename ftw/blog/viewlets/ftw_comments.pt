<tal:block define="userHasReplyPermission view/can_reply;
                   isDiscussionAllowed view/is_discussion_allowed;
                   replies view/get_replies;
                   isAnon view/is_anonymous"
           i18n:domain="plone">
    <div class="discussion"
         tal:condition="python:replies or (userHasReplyPermission and isDiscussionAllowed) or (isAnon and not userHasReplyPermission and isDiscussionAllowed)">
            

        
        <tal:getreplies repeat="reply_dict replies">
            <div class="comment" style=""
                tal:define="indent python:reply_dict['depth']*2;
                            reply python:reply_dict['object']"
                tal:attributes="style string:margin-left:${indent}em;">

                <h2 tal:condition="python:repeat['reply_dict'].index == 0">
                <span tal:replace="python: len(replies)" />
                 <tal:block i18n:translate="">Kommentar(e)</tal:block>
                </h2> 
                <h3 tal:define="creator reply/Creator;
                                anonymous_creator python:creator in ('Anonymous User', '');
                                mi python:not anonymous_creator and view.member_info(creator);
                                fullname python: mi and mi['fullname'] or creator;">
                    <span tal:replace="reply/pretty_title_or_id">Comment title</span>,
                    <span tal:content="fullname"
                          tal:condition="not:anonymous_creator">Poster Name</span>,
                    <span tal:content="python:here.toLocalizedTime(reply.ModificationDate(),long_format=True)">8/23/2001 12:40:44 PM</span>
                    
                </h3>
                <div class="commentBody">
                     <p tal:content="structure reply/CookedBody">
                     This is the body text of the comment.
                     </p>
                </div>
                <div class="actions clearfix">
                  <form name="reply"
                        action="discussion_reply_form"
                        method="post"
                        tal:attributes="action string:${reply/absolute_url}/discussion_reply_form"
                        tal:condition="python:userHasReplyPermission and isDiscussionAllowed">
                      <input class="submit secondary"
                             type="submit"
                             value="Reply"
                             i18n:attributes="value label_reply;"
                             />
                  </form>
                  <form name="delete"
                        action=""
                        method="post"
                        tal:condition="view/can_manage"
                        tal:attributes="action string:${reply/absolute_url}/deleteDiscussion">
                      <input class="submit secondary"
                             type="submit"
                             value="Remove"
                             i18n:attributes="value label_remove;"
                             />
                  </form>
                  </div>
            </div>
        </tal:getreplies>
        <div class="reply clearfix">
            <form name="reply"
                  action=""
                  method="post"
                  tal:condition="python:userHasReplyPermission and isDiscussionAllowed"
                  tal:attributes="action string:${context/absolute_url}/discussion_reply_form">

                  <input class="submit"
                         style="margin-bottom: 1.25em;"
                         type="submit"
                         value="Add Comment"
                         i18n:attributes="value label_add_comment;"
                         />
            </form>
            <form tal:condition="python:isAnon and not userHasReplyPermission and isDiscussionAllowed"
                  tal:attributes="action view/login_action">
                <input class="submit"
                       style="margin-bottom: 1.25em;"
                       type="submit"
                       value="Log in to add comments"
                       i18n:attributes="value label_login_to_add_comments;"
                       />
            </form>
        </div>
    </div>
</tal:block>
